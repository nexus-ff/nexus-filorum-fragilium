<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>nexus filorium fragilium</title>

<style>
:root {
  --fg: #000;
  --bg: #fff;
  --mono: "Courier New", "Lucida Console", monospace;
  --input-bg: #1a1a1a;
  --input-text: #ccc;
}

/* Layout */
body {
  background: var(--bg);
  color: var(--fg);
  font-family: var(--mono);
  margin: 0;
  padding: 0;
  overflow-x: hidden;
}

.page-wrap {
  max-width: 650px;
  padding: 20px;
  margin: 0 auto;
}

/* =========================
   TYPEWRITER
========================= */
#typewriter {
  margin-top: 20px;
  text-align: left;
  white-space: pre;
  font-size: 1.25rem;
  line-height: 1.35;
  position: relative;
  min-height: 7em; /* Reserviert Platz, damit Login nicht springt */
}

.type-line {
  display: block;
  min-height: 1.35em;
}

#cursor {
  display: inline-block;
  width: 0.85rem;
  height: 1.25rem;
  background: #000;
  animation: blink .6s infinite step-end;
  vertical-align: bottom;
}

@keyframes blink { 50% { opacity: 0; } }

/* =========================
   LOGIN
========================= */
#loginBlock {
  position: fixed;
  top: 58%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  z-index: 20;
}

/* Pfeil */
#arrow {
  width: 0.7px;
  background: #000;
  margin: 0 auto;
  position: relative;
  opacity: 0;
  transition: opacity .8s ease, transform .8s ease;
}

#arrow::after {
  content: "";
  position: absolute;
  bottom: -10px;
  left: 50%;
  transform: translateX(-50%);
  border-left: 5px solid transparent;
  border-right: 5px solid transparent;
  border-top: 10px solid #000;
}

/* Loginform */
#inputRow {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
}

#passwordInput {
  padding: 10px 12px;
  background: var(--input-bg);
  color: var(--input-text);
  border: 2px solid #000;
  border-radius: 6px;
  font-size: 16px;
  width: 170px;
}
#passwordInput::placeholder { color: #777; }

#loginBtn {
  padding: 10px 14px;
  font-size: 16px;
  background: #000;
  color: #fff;
  border: 2px solid #000;
  border-radius: 6px;
  cursor: pointer;
}

#errorMessage {
  color: #b00020;
  margin-top: 6px;
  min-height: 1.4em;
}

/* =========================
   CONTENT
========================= */
#content {
  display:none;
  margin-top: 260px;
  white-space: pre-wrap;
  line-height: 1.45;
  font-size: 1.05rem;
}

img {
  display: block;
  margin: 20px auto 0;
  width: 100%;
  max-width: 320px;
  border: 2px solid #000;
  border-radius: 10px;
  cursor: pointer;
  transition: 0.2s;
}
img:hover { transform: scale(1.03); }

</style>
</head>

<body>

<div class="page-wrap">

  <!-- TYPEWRITER -->
  <div id="typewriter"></div>

  <!-- LOGINBLOCK -->
  <div id="loginBlock">
    <div id="arrow"></div>

    <div id="inputRow">
      <input id="passwordInput" type="password" placeholder="Введи пароль..." />
      <button id="loginBtn">Войти</button>
    </div>

    <div id="errorMessage"></div>
  </div>

  <!-- CONTENT -->
  <div id="content">

<h2>Не рви — а распутывай</h2>

<em><strong>НИТИ</strong>

Внезапное призрение …
</em>

<img id="mainImage" src="image/IMG_8462.JPG">

  </div>

</div>

<script>
/* ===========================
   MULTILINE TYPEWRITER – stabil
=========================== */

const lines = [
  "Их много,",
  "они сплетены",
  "и норовят порваться.",
  "Не рви их."
];

const tw = document.getElementById("typewriter");
const arrow = document.getElementById("arrow");

let lineIndex = 0;
let charIndex = 0;
let currentLineDiv = null;

/* Schritt 1: Zeile erzeugen */
function newLine() {
  currentLineDiv = document.createElement("div");
  currentLineDiv.className = "type-line";
  tw.appendChild(currentLineDiv);
}

/* Schritt 2: Cursor anhängen */
function attachCursor() {
  const cur = document.createElement("span");
  cur.id = "cursor";
  currentLineDiv.appendChild(cur);
}

/* Schreibprozess */
function randomDelay() {
  return Math.random() * 100 + 20;
}

function typeWriter() {

  if (lineIndex >= lines.length) {
    showArrow();
    return;
  }

  if (!currentLineDiv) {
    newLine();
    attachCursor();
  }

  const cursor = currentLineDiv.querySelector("#cursor");
  const line = lines[lineIndex];

  if (charIndex < line.length) {
    cursor.remove();
    currentLineDiv.textContent += line[charIndex++];
    currentLineDiv.appendChild(cursor);
    setTimeout(typeWriter, randomDelay());
  } else {
    cursor.remove();
    currentLineDiv.textContent += "";
    lineIndex++;
    charIndex = 0;
    newLine();
    attachCursor();
    setTimeout(typeWriter, 350);
  }
}

typeWriter();

/* ===========================
   PFEIL
=========================== */

function updateArrow() {
  const twBox = tw.getBoundingClientRect();
  const loginBox = document.getElementById("loginBlock").getBoundingClientRect();

  const dist = loginBox.top - twBox.bottom - 15;
  arrow.style.height = dist + "px";
}

function showArrow() {
  requestAnimationFrame(() => {
    updateArrow();
    arrow.style.opacity = 1;
    arrow.style.transform = "translateY(0)";
  });
}

window.addEventListener("resize", updateArrow);

/* ===========================
   LOGIN
=========================== */

const correctPassword = "нити";

function checkPassword() {
  const val = document.getElementById("passwordInput").value.trim();
  const error = document.getElementById("errorMessage");

  if (val === correctPassword) {
    document.getElementById("content").style.display = "block";
    document.getElementById("loginBlock").style.display = "none";
    fetch("/api/notify", { method: "POST" });
  } else {
    error.innerHTML = "❌ Неверный пароль<br>русскими маленькими буквами";
    document.getElementById("passwordInput").value = "";
  }
}

document.getElementById("loginBtn").onclick = checkPassword;
document.getElementById("passwordInput").addEventListener("keydown", e=>{
  if (e.key === "Enter") checkPassword();
});

/* ===========================
   IMAGE TOGGLE
=========================== */
const img = document.getElementById("mainImage");
let toggled = false;

img.addEventListener("mouseenter", () => {
  img.src = "image/IMG_20251029_213356_289.jpg";
});
img.addEventListener("mouseleave", () => {
  if (!toggled) img.src = "image/IMG_8462.JPG";
});
img.addEventListener("click", () => {
  toggled = !toggled;
  img.src = toggled
    ? "image/IMG_20251029_213356_289.jpg"
    : "image/IMG_8462.JPG";
});
</script>

</body>
</html>
